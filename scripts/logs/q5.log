/*
 * q5 - five queries
 * Write five queries on your project database, using the select-from-where construct of SQL.
 * The queries should be typical queries of the application domain.
 * To receive full credit, all but perhaps one of your queries must exhibit some interesting feature of SQL:
 * queries over more than one relation, subqueries,
 * aggregations, grouping etc
 */

-- queries
SELECT * FROM creditCards
WHERE holder_name LIKE 'M%'
LIMIT 7;
    pid     |   card_number    | expiry_date |   holder_name    
------------+------------------+-------------+------------------
 3778745455 | 4556339227888775 | 2019-01-10  | MORGAN FARRELL
 0981042957 | 4765156358556485 | 2019-04-19  | MEGAN KENNETT
 NpFI4hjV3d | 741619613891     | 2021-10-19  | Miss Carol Hauck
 kww8m2TXUF | 831654235022     | 2021-06-12  | Miss Carol Hauck
 whPXerVlR8 | 808292961830     | 2020-08-23  | Meggie Purdy
 FxuUWU5xZ0 | 343384009685     | 2020-02-06  | Mervin Schinner
 WyLp7KYxUO | 311224773234     | 2019-05-20  | Miles Hermann
(7 rows)


SELECT * FROM creditCards
WHERE expiry_date < '2018-03-31' ORDER BY holder_name ASC
LIMIT 5;
    pid     |   card_number    | expiry_date |     holder_name      
------------+------------------+-------------+----------------------
 50MEW7yVgp | 120936542356     | 2018-03-25  | Alexie McDermott
 y4pg5LJgeu | 061178930312     | 2018-03-02  | Gabriella Stehr
 dWCs8gGkPY | 561634720996     | 2018-02-04  | Jarrod Tillman V
 Rss5QJ7xO3 | 731216183199     | 2018-03-02  | Maritza Zboncak
 9ExAdtaLZT | 471294378718     | 2018-01-04  | Ms. Christophe Nolan
(5 rows)


SELECT r.name FROM restaurants r
WHERE EXISTS (SELECT addresses.aid = r.aid FROM addresses
			  	WHERE addresses.borough = 'Saint-Laurent')
LIMIT 7;
         name          
-----------------------
 Amir
 Restaurant Il Puntino
 Restaurant Bouf Vit
 Mikes
 Cuisine AuntDai
 Restaurant C. Thai
 Place Chaumont
(7 rows)


-- aggregations, exists, group by, subqueries
SELECT license_id, avg(rating) FROM reviews
WHERE EXISTS (SELECT restaurants.license_id FROM restaurants
			  WHERE restaurants.opening_hours = '10:00')
GROUP BY license_id
LIMIT 7;
 license_id |          avg           
------------+------------------------
 DIVSJfEg0n |     3.0000000000000000
 2PHRUCHecL |     3.0000000000000000
 H2JvO8O4my |     2.0000000000000000
 BzZ86WdFsK | 1.00000000000000000000
 I4zaUKbrkV |     3.0000000000000000
 jfRTlJB54m |     4.0000000000000000
 kb8lNgM149 |     3.0000000000000000
(7 rows)


-- aggregations, exists
SELECT borough, count(*) AS TotalDeliveryStaffs FROM deliveryStaffs
WHERE borough IN ('Outremont', 'Saint-Laurent', 'Ville-Marie', 'Le Plateau-Mont-Royal', 'Lachine')
GROUP BY borough;
        borough        | totaldeliverystaffs 
-----------------------+---------------------
 Lachine               |                  12
 Le Plateau-Mont-Royal |                   7
 Outremont             |                   4
 Ville-Marie           |                  13
 Saint-Laurent         |                   7
(5 rows)



/*
-- subqueries // TODO add data
SELECT c.name FROM customers c
WHERE EXISTS (SELECT d.cell_phone_number FROM deliveryStaffs d
              WHERE d.cell_phone_number = c.cell_phone_number);
*/
